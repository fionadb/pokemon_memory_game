<!DOCTYPE html>
<html lang="en" ng-app="pokemonMemoryGame">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Memory Game</title>
    <link rel="stylesheet" href="styles/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
</head>
<body ng-controller="GameController as game" ng-class="{'game-won': game.gameWon}">
    <!-- Fireworks overlay -->
    <div ng-if="game.showFireworks" class="fireworks-overlay">
        <div class="firework"></div>
        <div class="firework"></div>
        <div class="firework"></div>
        <div class="firework"></div>
        <div class="firework"></div>
    </div>

    <!-- Combo notification -->
    <div ng-if="game.showCombo" class="combo-notification">
        <span class="combo-text">🔥 {{game.comboCount}}x COMBO! 🔥</span>
    </div>

    <!-- Streak notification -->
    <div ng-if="game.showStreak" class="streak-notification">
        <span class="streak-text">{{game.getStreakMessage()}}</span>
    </div>

    <!-- Enhanced message display -->
    <div ng-if="game.getCurrentMessage()" class="message-display" ng-class="{'victory-message': game.gameWon}">
        <div class="message-content">
            <span class="message-icon" ng-if="!game.gameWon">🎮</span>
            <span class="message-icon" ng-if="game.gameWon">🏆</span>
            <span class="message-text">{{game.getCurrentMessage()}}</span>
        </div>
    </div>

    <div class="game-container">
        <header class="game-header">
            <h1>🎮 Pokemon Memory Game 🎮</h1>
            <div class="game-controls">
                <div class="control-group">
                    <label>Grid Size:</label>
                    <select ng-model="game.gridSize" ng-change="game.onGridSizeChange()">
                        <option value="4">4x4 (Easy)</option>
                        <option value="6">6x6 (Medium)</option>
                        <option value="8">8x8 (Hard)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Players:</label>
                    <select ng-model="game.playerCount" ng-change="game.onPlayerCountChange()">
                        <option value="1">1 Player</option>
                        <option value="2">2 Players</option>
                    </select>
                </div>
                <button ng-click="game.resetGame()" class="reset-btn">🎲 New Game</button>
                <button ng-click="game.toggleLeaderboard()" class="leaderboard-btn">🏆 Leaderboard</button>
            </div>
        </header>

        <div class="game-info">
            <div class="score-board">
                <div class="player-score" ng-repeat="player in game.players track by $index" 
                     ng-class="{'active': $index === game.currentPlayer}">
                    <span class="player-name">
                        <span ng-if="$index === 0">🥇</span>
                        <span ng-if="$index === 1">🥈</span>
                        Player {{$index + 1}}
                    </span>
                    <span class="score">{{player.score}} ⭐</span>
                    <div class="player-stats">
                        <span ng-if="player.streak > 0" class="streak-indicator">🔥 {{player.streak}}</span>
                        <span ng-if="player.powerUps > 0" class="powerup-indicator">⚡ {{player.powerUps}}</span>
                    </div>
                </div>
            </div>
            <div class="game-stats">
                <span>🎯 Moves: {{game.moves}}</span>
                <span>⏱️ Time: {{game.formatTime(game.elapsedTime)}}</span>
                <span ng-if="game.comboCount > 1">🔥 Combo: {{game.comboCount}}x</span>
                <span ng-if="game.streakCount > 0" class="streak-display">⚡ Streak: {{game.streakCount}}</span>
            </div>
        </div>

        <div class="game-board" ng-style="{'grid-template-columns': 'repeat(' + game.gridSize + ', 1fr)'}">
            <div ng-repeat="card in game.cards track by $index" 
                 class="card" 
                 ng-class="{
                     'flipped': card.isFlipped, 
                     'matched': card.isMatched,
                     'shaking': card.isShaking,
                     'match-effect': card.showMatchEffect,
                     'power-up': card.isPowerUp
                 }"
                 ng-click="game.flipCard($index)"
                 ng-style="card.isMatched && {'border-color': game.getTypeColor(card.pokemon)}">
                <div class="card-inner">
                    <div class="card-front">
                        <img src="assets/pokeball.svg" alt="Card back" class="card-back-img">
                        <div class="pokeball-shine"></div>
                        <!-- Power-up indicator -->
                        <div ng-if="card.isPowerUp" class="power-up-glow">⚡</div>
                    </div>
                    <div class="card-back" ng-style="{'background': 'linear-gradient(135deg, ' + game.getTypeColor(card.pokemon) + ', #667eea)'}">
                        <img ng-src="{{game.getCardImage(card)}}" 
                             alt="{{card.pokemon.name}}" 
                             class="pokemon-img"
                             ng-error="game.handleImageError($event, card)">
                        <span class="pokemon-name">{{card.pokemon.name}}</span>
                        <div class="pokemon-types">
                            <span ng-repeat="type in card.pokemon.types" class="type-badge" ng-style="{'background-color': game.getTypeColor({types: [type]})}" >
                                {{type}}
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Match sparkles -->
                <div ng-if="card.showMatchEffect" class="match-sparkles">
                    <div class="sparkle sparkle-1">✨</div>
                    <div class="sparkle sparkle-2">⭐</div>
                    <div class="sparkle sparkle-3">💫</div>
                    <div class="sparkle sparkle-4">🌟</div>
                </div>
            </div>
        </div>

        <div ng-if="game.gameWon" class="game-over-modal">
            <div class="modal-content celebration">
                <div class="trophy-animation">🏆</div>
                <h2>{{game.getCurrentMessage()}}</h2>
                <div ng-if="game.playerCount === 1" class="victory-stats">
                    <p>🎯 Completed in {{game.moves}} moves!</p>
                    <p>⏱️ Time: {{game.formatTime(game.elapsedTime)}}</p>
                    <p ng-if="game.perfectGameBonus">💎 PERFECT! Minimum moves achieved! (+5 ⭐)</p>
                    <p ng-if="game.speedBonus">⚡ LIGHTNING FAST! Speed bonus! (+3 ⭐)</p>
                    <p ng-if="game.players[0].powerUps > 0">⚡ Power-ups used: {{game.players[0].powerUps}}</p>
                </div>
                <div ng-if="game.playerCount === 2" class="victory-stats">
                    <div class="winner-announcement">
                        <p ng-if="game.players[0].score > game.players[1].score">🥇 Player 1 Wins! 🎉</p>
                        <p ng-if="game.players[1].score > game.players[0].score">🥇 Player 2 Wins! 🎉</p>
                        <p ng-if="game.players[0].score === game.players[1].score">🤝 It's a Tie! Amazing!</p>
                    </div>
                    <p>📊 Final Score: Player 1: {{game.players[0].score}} ⭐ - Player 2: {{game.players[1].score}} ⭐</p>
                    <div class="player-stats-final">
                        <p>🔥 Player 1 Best Streak: {{game.players[0].streak}}</p>
                        <p>🔥 Player 2 Best Streak: {{game.players[1].streak}}</p>
                    </div>
                </div>
                <button ng-click="game.resetGame()" class="play-again-btn">🚀 Play Again</button>
            </div>
        </div>

        <div ng-if="game.loading" class="loading-modal">
            <div class="loading-content">
                <div class="pokeball-loader">
                    <div class="pokeball-top"></div>
                    <div class="pokeball-bottom"></div>
                    <div class="pokeball-center"></div>
                </div>
                <p>🔍 Catching Pokemon...</p>
                <div class="loading-dots">
                    <span>.</span><span>.</span><span>.</span>
                </div>
            </div>
        </div>

        <!-- Player Name Input Modal -->
        <div ng-if="game.showNameInput" class="name-input-modal">
            <div class="modal-content name-input-content">
                <h2>🎮 Enter Player Names</h2>
                <div class="name-inputs">
                    <div ng-repeat="name in game.tempPlayerNames track by $index" class="name-input-group">
                        <label>Player {{$index + 1}} Name:</label>
                        <input type="text" 
                               ng-model="game.tempPlayerNames[$index]" 
                               placeholder="Enter name (optional)"
                               class="name-input"
                               maxlength="20">
                    </div>
                </div>
                <div class="name-input-buttons">
                    <button ng-click="game.confirmPlayerNames()" class="confirm-btn">✅ Start Game</button>
                    <button ng-click="game.cancelNameInput()" class="cancel-btn">❌ Cancel</button>
                </div>
            </div>
        </div>

        <!-- Leaderboard Modal -->
        <div ng-if="game.showLeaderboard" class="leaderboard-modal">
            <div class="modal-content leaderboard-content">
                <div class="leaderboard-header">
                    <h2>🏆 Leaderboard</h2>
                    <button ng-click="game.toggleLeaderboard()" class="close-btn">❌</button>
                </div>
                
                <div class="leaderboard-tabs">
                    <button ng-click="game.currentLeaderboardTab = 'current'" 
                            ng-class="{'active': game.currentLeaderboardTab !== 'all'}"
                            class="tab-btn">
                        Current Difficulty ({{game.getDifficultyName()}})
                    </button>
                    <button ng-click="game.currentLeaderboardTab = 'all'" 
                            ng-class="{'active': game.currentLeaderboardTab === 'all'}"
                            class="tab-btn">
                        All Difficulties
                    </button>
                </div>

                <div class="leaderboard-list" ng-if="game.currentLeaderboardTab !== 'all'">
                    <div ng-if="game.getLeaderboardForCurrentDifficulty().length === 0" class="no-scores">
                        🎯 No scores yet! Be the first to complete this difficulty!
                    </div>
                    <div ng-repeat="entry in game.getLeaderboardForCurrentDifficulty() track by $index" 
                         class="leaderboard-entry"
                         ng-class="{'top-score': $index === 0, 'recent-score': $index < 3}">
                        <div class="rank">
                            <span ng-if="$index === 0">🥇</span>
                            <span ng-if="$index === 1">🥈</span>
                            <span ng-if="$index === 2">🥉</span>
                            <span ng-if="$index > 2">{{$index + 1}}</span>
                        </div>
                        <div class="player-info">
                            <div class="player-name">{{entry.name}}</div>
                            <div class="player-details">
                                {{entry.difficulty}} • {{entry.date}}
                            </div>
                        </div>
                        <div class="stats">
                            <div class="score">{{entry.score}} ⭐</div>
                            <div class="time">⏱️ {{game.formatLeaderboardTime(entry.time)}}</div>
                            <div class="moves">🎯 {{entry.moves}} moves</div>
                        </div>
                    </div>
                </div>

                <div class="leaderboard-list" ng-if="game.currentLeaderboardTab === 'all'">
                    <div ng-if="game.getAllLeaderboard().length === 0" class="no-scores">
                        🎯 No scores yet! Start playing to see your achievements!
                    </div>
                    <div ng-repeat="entry in game.getAllLeaderboard() track by $index" 
                         class="leaderboard-entry"
                         ng-class="{'top-score': $index === 0}">
                        <div class="rank">
                            <span ng-if="$index === 0">🏆</span>
                            <span ng-if="$index > 0">{{$index + 1}}</span>
                        </div>
                        <div class="player-info">
                            <div class="player-name">{{entry.name}}</div>
                            <div class="player-details">
                                {{entry.difficulty}} • {{entry.date}}
                            </div>
                        </div>
                        <div class="stats">
                            <div class="score">{{entry.score}} ⭐</div>
                            <div class="time">⏱️ {{game.formatLeaderboardTime(entry.time)}}</div>
                            <div class="moves">🎯 {{entry.moves}} moves</div>
                        </div>
                    </div>
                </div>

                <div class="leaderboard-actions">
                    <button ng-click="game.clearLeaderboard()" class="clear-btn" 
                            ng-confirm="Are you sure you want to clear all scores?">
                        🗑️ Clear All Scores
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>